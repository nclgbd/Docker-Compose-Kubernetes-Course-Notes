This section focuses on:
- Images and Containers
	- Using pre-built and custom images
- Creating and managing containers
## [Cheat sheet](obsidian://open?vault=docker-compose-kubernetes-course&file=cheatsheets%2FCheat-Sheet-Images-Containers.pdf)
# Images and Containers

| **Question**                                                                  | Response                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ----------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **What is a Container?**                                                      | A container is an isolated environment that runs a "unit of software."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **What is an Image?**                                                         | An image is a template that is used for creating containers, and includes the necessary tools needed at runtime.<br><br>Images often are a starting point and are meant to be built off of. You can do this by using a `Dockerfile`.<br><br>Images are read-only, meaning that after running `docker build <path-to-dockerfile>` the resulting image's source code cannot be changed. In order to do this, we need to rerun the `docker build` command.                                                                                                                                                                                                                                                                                                                                                                                       |
| **What is the different between an Image and a Container?**                   | An image creates multiple reproducible containers. These images are ultimately what actually get shared when replicating an environment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **How are docker images built?**                                              | Docker images are built in layers. Each layer is represented as an instruction given by docker (i.e. `COPY` or `RUN`). Each layer is then cached, so upon subsequent builds if there is minimal changes to the code, then only a few associated layers need to be rebuilt<br><br>When an image is rebuilt, any subsequent layer from a rebuilt layer will be run. This means that there can be optimizations based on the order in which layers are built. Therefore, instructions that you know do not depend on subsequent layers should be run earlier in the `Dockerfile` to minimize the number of layers that need to be rebuilt.                                                                                                                                                                                                       |
| **Give an example of working with both a docker image and docker container.** | For example, we can test using the `node` docker image available on [Docker Hub](link).<br><br>First, we pull the image using `docker pull node`, which downloads and caches the most recent version of NodeJS.<br><br>To create a container, we use the `docker run node` command. This will create a container based on the associated `Dockerfile`.<br><br>In contrast, we could instead run `docker run -it node`, which enables an interactive isolated environment that you can run commands inside of.<br><br>Note that when we use the `docker run` command, a new container is always created.                                                                                                                                                                                                                                       |
| **How do you build an image?**                                                | To build and image, you first have to have a `Dockerfile` with instructions for how to prepare the environment. Here is an example:<br><br>```dockerfile<br># Use the official Node.js image as the base image<br>FROM node<br><br># Set the working directory in the container to /app<br>WORKDIR /app<br><br># Copy all files from the current directory to /app in the folder in the container. This only works because we changed the working directory to /app<br>COPY . ./<br># App specific command for installing dependencies<br>RUN npm install<br><br># Expose port 80 to the outside world. This is the port that the Node.js application will listen on.<br><br>EXPOSE 80<br><br># The above instructions are for the build stage. The following instructions are for the run stage.<br><br>CMD ["node", "server.js"]<br>```<br> |
| **How do you access a container?**                                            | To access a container, within the `Dockerfile` you can add the line `EXPOSE <port>`. This is not required, however when running the container you can use this port to access the application: `docker run -p <local-port>:<port>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
# Creating and managing containers

| **Question**                                                                           | Response                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| -------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **What command can you run to get help on a specific docker command?**                 | `docker --help` and `docker COMMAND --help`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **What does `docker ps` do?**                                                          | `docker ps` lists the current running containers. We can see all containers, both stopped and running, by using `docker ps -a`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **What does `docker images` do?**                                                      | `docker images` lists all images                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **What does `docker start` do?**                                                       | `docker start <container-id>` will run a specific container in a detached mode. Note that this is different from `docker run` which creates a new container and has it's own additional arguments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **What is detached mode, and when should you use it?**                                 | Detached mode is a mode that allows a container to run in the background. By default, the `docker run` command will start a new container in the foreground and thus "locking" your terminal window. `docker start` by default will start the container in the background.<br><br>Both of these defaults can be easily overwritten on the command line. Running `docker start -a <container-id>` will start the container in attached mode. `docker run -d <image-id>` will start a new container in detached mode.<br><br>Using detached mode when you require some direct interaction with the container. Use attached mode when you need to look at output as it's generated. Either option can be used for debugging it just depends on the application |
| **How do can you find system messages generated by a container in detached mode?**     | You can reattach using the `docker container attach <container-id>` command, or you can use `docker logs <container-id>` which will print out all logs that have been generated by that container.<br><br>You can also use follow mode by running `docker logs -f <container-id>` which prints out the generated logs but also reattaches to the container.                                                                                                                                                                                                                                                                                                                                                                                                 |
| **What is interactive mode? How can you use it with `docker run` and `docker start`?** | Interactive mode is a way to execute commands from within the docker container.<br><br>To use interactive mode with `docker run`, simply add the `-it` flag. Note that `-i` allows for commands to be executed, while `-t` command creates a separate terminal to execute those commands.<br><br>To use interactive mode with `docker start`, you add the `-ai` flags. As discussed earlier, `-a` will reattach you to the container, while `-i` is still just the interactive flag allowing interaction with the container.                                                                                                                                                                                                                                |
| **How do you remove containers?**                                                      | To remove containers, first make sure that they are stopped. Then run the command `docker rm <container-id>`. You can remove multiple containers by simply adding all of their container IDs in the same command separated by white space.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **How do you remove images?**                                                          | To remove an image, first make sure that there are no containers that depend on the image. This means you have to remove the container, it is not enough to just stop them. Then run the command `docker rmi <image-id>`. You can similarly remove multiple images by listing them separated by white space.<br><br>You can remove all images that have no containers by running `docker image prune`.                                                                                                                                                                                                                                                                                                                                                      |
| **How do you automatically remove a container once it is stopped?**                    | You can use the `--rm` flag with `docker run`. For example, `docker run -p 3000:80 --rm <image-id>` will create a new container with a port published on port 80. Once this container is stopped, it will be removed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **How can you get metadata on a specific image?**                                      | You can use `docker image inspect <image-id>`. This will give you a lot of metadata including the creation date, base operating system, and cached layers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **How can you copy files into and out of a docker container?**                         | To copy a local file into a running docker container you can use `docker cp /path/to/src <container-id>:/path/to/dest`. For example, `docker cp data.csv <container-id>:/data` will copy the local file `data.csv` to the container in a folder `/data`.<br><br>The reverse can be done by running `docker cp <container-id>:/data/data.csv ./` will copy the `/data/data.csv` file into the current local directory `./`.                                                                                                                                                                                                                                                                                                                                  |
| **How can you name a container?**                                                      | `docker run --name <name>`. This now allows you to reference this container using the name rather than the container id, although both will still work                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **How can you assign a tag to an image?**                                              | `docker build -t <name>:<tag>`. The `name` defines a group of (possibly more specialized) images. `tag` defines the specialized image within the group of images.<br><br>You can rename an existing image by using the `docker tag` command. Specifically `docker tag <old-name>:<old-tag> <new-name>:<new-tag>`. Note that this creates a clone of the old version of the docker image.<br><br>This is useful when you need a specific version of an image. For example, `node:latest` is a node image with the latest version of `node`, while `node:12` is a node image with version 12. This is useful if the application was built using specifically version 12                                                                                       |
| **What's the difference between naming a container and "naming" an image?**            | When you name a container it only needs a name. You can name an image using both a name and a tag, but adding a tag is not required                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **What are some ways to share a docker image?**                                        | One way to share a docker image is by providing the `Dockerfile` and the related source code. This is analogous to how we've been doing work in this course.<br><br>Another way to share a docker image is by sharing the built image. This is the most common way to share images, specifically through docker hub or a private registry.                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **How do you push to Docker Hub?**                                                     | `docker push <name>:<tag>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **How do you pull from Docker Hub?**                                                   | `docker pull <name>:<tag>`. Note that when you run this image after updates that have been made, you will have to rerun this command to have those changes locally.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

